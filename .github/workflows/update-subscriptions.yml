name: üîÑ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–æ–≤

on:
  schedule:
    - cron: '0 */3 * * *'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          token: ${{ secrets.MY_PAT }}
          fetch-depth: 0
      
      - uses: actions/setup-python@v5
        with:
          python-version: '3.10'
          
      - run: pip install aiohttp
      
      - working-directory: ./source
        run: python parser.py
      
      - name: –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–û–ï –ò–ó–ú–ï–ù–ï–ù–ò–ï
        run: |
          # –°–æ–∑–¥–∞—ë–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª —Å timestamp
          echo "üïí Force update $(date -Iseconds)" > deploy/force-update.txt
          
          # –ú–µ–Ω—è–µ–º README –µ—Å–ª–∏ –µ—Å—Ç—å
          if [ -f "README.md" ]; then
            echo -e "\n\n*Force update: $(date)*" >> README.md
          fi
          
      - name: 
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          
          # –î–æ–±–∞–≤–ª—è–µ–º –≤—Å—ë –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ
          git add -f deploy/
          git add -f README.md
          
          # –í–°–ï–ì–î–ê –¥–µ–ª–∞–µ–º –∫–æ–º–º–∏—Ç (–¥–∞–∂–µ –µ—Å–ª–∏ –Ω–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π)
          git commit -m "üîÑ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ $(date +'%Y-%m-%d %H:%M:%S')" --allow-empty
          
          # –ü—É—à–∏–º
          git pull --rebase origin main || true
          git push origin main
          
          echo "‚úÖ –ö–û–ú–ú–ò–¢ –°–û–ó–î–ê–ù!"
